<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>GRAF - Graphic Rendering Architecture Framework</title>
	<style type="text/css">
		iframe {
			border:0px;
			overflow:scroll;
		}
		body {
			margin:0px
		}
		.menu {
			border : 4px outset;
			padding : 10px;
			margin:5px;
			background-color : #ffde49;
		}
		.menu:hover {
			border : 4px inset;
			background-color : white;
		}
 	</style>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script type="text/javascript" src="script/util.js"></script>
	<script type="text/javascript" src="script/service.js"></script>
	<script type="text/javascript" src="script/process.js"></script>
	<script type="text/javascript" src="script/business.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>
		function displayStrategic(){
			hideToolBox();
			$("#strategic_toolbox").show();
			strategic_checkSeeProcess();
		}
		
		
		function strategic_checkSeeProcess(){
			if( $('input[name=strategic_viewprocess]').is(':checked') ){
				changeImage("views/view_strategique.php?showProcess=true");
			} else {
				changeImage("views/view_strategique.php");
			}
		}
		
		function business_createProcess(){
			var domainId = $("#domainSelected").val();
			if ((domainId == null) || (domainId == "null")){
				return;
			}
			$("#process_create_form_domain_id").val(domainId);
			$("#process_create_form").dialog({"modal":true,"title":"Création d'un processus"});
		}
		function business_submit_create_process(){
			var name 	= $("#process_create_form_name").val();
			var description = $("#process_create_form_description").val();
			var domain_id 	= $("#process_create_form_domain_id").val();
			$.ajax({
				type 	: "POST",
				url 	: "api/process.php",
				data	: {
					"name"		: name,
					"description"	: description,
					"domain_id"	: domain_id},
				dataType: "text",
				success	: function( data ) {
	    				alert("Processus créé");
					$("#process_create_form").dialog("close");
					displayBusiness(null);
				}
			})
  			.fail(function(jxqr,textStatus,error){
				alert(textStatus+" : "+error);
			});
		}
		function displayLogic(){
			hideToolBox();
			$("#logic_toolbox").show();
			clearFrame();
			//view_logique
			//document.getElementById('frame').data='views/view_views.php
			//document.getElementById('frame').data='views/view_processes.php'
			//document.getElementById('frame').data='views/view_technique.php'
		}
		function selectDomain(){
			var id = $("#domainSelected").val();
			if (id != "null"){
				displayBusiness(id);
			} else {
				displayBusiness(null);
			}
		}
		

		function displayTechnic(){
			hideToolBox();
			$("#technic_toolbox").show();
			clearFrame();
		}
		function displayViews(){
			hideToolBox();
			$("#views_toolbox").show();
			selectView();
		}
		function views_checkFill(){
			selectView();
		}
		function selectView(){
			var view = $("#viewSelected").val();
			if (view == "null"){
				clearFrame();
			} else {
				if( $('input[name=views_fill]').is(':checked') ){
					changeImage("views/view_views.php?view="+view);
				} else {
					changeImage("views/view_views.php?view="+view+"&fill=no");
				}
			}
		}

	</script>
</header>
<body>
<div style="width:10%;height:100%;background-color:#5588EE; float: left;">
	<div style="width:100%;height:100px;text-align:center;color:white;vertical-align:middle;padding-top:10px">
		<div style="font-size:35px">GRAF</div>
		<div style="font-size:14px">Graphic Rendering<br/>Architect Framework</div>
	</div>
	<div class="menu" onclick="displayStrategic(null)">Vue strat&eacute;gique</div>
	<div class="menu" onclick="displayBusiness(null)">Vue métier</div>
	<div class="menu" onclick="displayLogic(null)">Vue logique</div>
	<div class="menu" onclick="displayService(null)">Vue service</div>
	<div class="menu" onclick="displayProcess(null)">Vue processus</div>
	<div class="menu" onclick="displayTechnic(null)">Vue technique</div>
	<div class="menu" onclick="displayViews(null)">Gestion des vues</div>
</div>
<div style="width:90%;height:100%;float: right">
	<div style="width:100%">
		<div id="default_toolbox" style="width:100%">
		</div>
		<div id="strategic_toolbox" style="width:100%;display:none" class="controlgroup">
			<button onclick="createDomain()">Cr&eacute;er un domain</button>
			<label for="strategic_viewprocess">Voir les processus</label>
			<input type="checkbox" name="strategic_viewprocess" id="strategic_viewprocess" onclick="strategic_checkSeeProcess()"/>
		</div>
		<div id="service_toolbox" style="width:100%;display:none" class="controlgroup">
			<button id="service_create_component_button" onclick="createComponent()" disabled="true">Cr&eacute;er un composant</button>
			<button id="service_create_instance_button" onclick="createServiceInstance()" disabled="true">Cr&eacute;er une instance</button>
		</div>
		<div id="process_toolbox" style="width:100%;display:none" class="controlgroup">
			<button id="process_create_step_button" onclick="createStep()" disabled="true">Cr&eacute;er une étape</button>
		</div>
		<div id="business_toolbox" style="width:100%;display:none" class="controlgroup">
			<select id="domainSelected">
			</select>
			<button id="business_create_process_button" onclick="business_createProcess()" disabled="true">Cr&eacute;er un processus</button>
			<button id="business_create_service_button" onclick="createService()" disabled="true">Cr&eacute;er un service</button>
		</div>
		<div id="technic_toolbox" style="width:100%;vertical-align:middle;display:none" class="controlgroup">
			<label for="transmission-automatic">Automatic</label>
			<input type="checkbox" name="transmission-automatic" id="transmission-automatic"/>
		</div>
		<div id="views_toolbox" style="width:100%;display:none" class="controlgroup">
			<select id="viewSelected">
				<option value="null" selected>--choisir une vue--</option>
			</select>
			<label for="views_fill">Remplir</label>
			<input type="checkbox" name="views_fill" id="views_fill" onclick="views_checkFill()" checked/>
	      <!--label for="transmission-standard">Standard</label>
	      <input type="radio" name="transmission" id="transmission-standard">
	      <label for="transmission-automatic">Automatic</label>
     	 <input type="radio" name="transmission" id="transmission-automatic">
      <label for="insurance">Insurance</label>
      <input type="checkbox" name="insurance" id="insurance">
      <label for="horizontal-spinner" class="ui-controlgroup-label"># of cars</label>
      <input id="horizontal-spinner" class="ui-spinner-input">
      <button>Book Now!</button-->
		</div>
	</div>
		<!--object id="frame" type="image/svg+xml" data="" style="width:100%;height:100%"></object-->
		<!--img id="frame" src="" style="width:100%;height:100%"/-->
	<div style="width:100%;height:95%;float: bottom">
	<iframe id="frame" style="width:100%;height:100%" scrolling="yes"></iframe>
	<!--img id="frame" src="views/view_process.php?id=1" style="width:100%;height:100%"/-->
	</div>
</div>
<div id="popup" style="display:none">
</div>
<div id="domain_create_form" style="display:none">
	Nom : 		<input type="text" 	id="domain_create_form_name" 		name="name"/><br/>
	Zone : 		<select id="domain_create_form_area"></select>
	<hr/>
	<button onclick='doCreateDomain()'>Créer</button>
	<button onclick='$("#domain_create_form").dialog("close");'>Annuler</button>
</div>
<div id="process_create_form" style="display:none">
	Nom : 		<input type="text" 	id="process_create_form_name" 		name="name"/><br/>
	Description : 	<textarea 		id="process_create_form_description" 	name="description"></textarea><br/>
			<input type="hidden" 	id="process_create_form_domain_id" 	name='domain_id' value=""/>
	<hr/>
	<button onclick='business_submit_create_process()'>Créer</button>
	<button onclick='$("#process_create_form").dialog("close");'>Annuler</button>
</div>
<div id="create_service_form" style="display:none">
	Nom : 	<input type="text"		id="create_service_form_name" 		name="name"/><br/>
	Code :	<input type="text"		id="create_service_form_code" 		name="code"/><br/>
			<input type="hidden" 	id="create_service_form_domain_id" 	name='domain_id'/>
	<hr/>
	<button onclick='doCreateService()'>Cr&eacute;er</button>
	<button onclick='$("#create_service_form").dialog("close");'>Annuler</button>
</div>
<div id="create_instance_form" style="display:none">
	Nom : 			<input type="text"		id="create_instance_form_name" 		name="name"/><br/>
	Environment :	<select id="create_instance_form_environment"/><br/>
			<input type="hidden" 	id="create_instance_form_service_id" 	name='service_id'/>
	<hr/>
	<button onclick='doCreateServiceInstance()'>Cr&eacute;er</button>
	<button onclick='$("#create_instance_form").dialog("close");'>Annuler</button>
</div>
<!--img id="frame" src="" style="width:90%;height:94%;position:absolute;right:0;bottom:0px"/-->
<!--iframe id="frame" style="width:90%;height:94%;position:absolute;right:0;bottom:0px">
</iframe-->
<script>
	function refreshDomainList(){
		$.getJSON( "api/domain.php", function(result) {
			var domains = result.domains;
			$('#domainSelected').html("<option value='null' selected>--choisir un domaine--</option>");
			var options = "";
			for (var i = 0; i < domains.length; i++){
				var domain = domains[i];
				options += '<option value="'+domain.id+'">'+domain.name+'</option>';
			}
			$('#domainSelected').append(options);
  		}).fail(function(jxqr,textStatus,error) {
			showPopup("Echec","<h1>Impossible de charger les domaines</h1>"+textStatus+ " : " + error);
		});
	}
	function refreshEnvironmentList(){
		$.getJSON("api/environment.php", function(result){
			var environments = result.environments;
			$('#create_instance_form_environment').html("<option value='null' selected>--choisir un environement--</option>");
			var options = "";
			for (var i = 0; i < environments.length; i++){
				var environment = environments[i];
				options += '<option value="'+environment.id+'">'+environment.name+'</option>';
			}
			$('#create_instance_form_environment').append(options);
		}).fail(function(jxqr,textStatus,error) {
			showPopup("Echec","<h1>Impossible de charger les domaines</h1>"+textStatus+ " : " + error);
		});
	}
	$( function() {
	 	$(".controlgroup" ).controlgroup();
		$.getJSON( "api/view.php", function(result) {
			var views = result.views;
			var options = "";
			for (var i = 0; i < views.length; i++){
				var view = views[i];
				options += '<option value="'+view.name+'">'+view.name+'</option>';
			}
			$('#viewSelected').append(options);
  		}).fail(function(jxqr,textStatus,error) {
			showPopup("Echec","<h1>Impossible de charger les vues</h1>"+textStatus+ " : " + error);
		});
		$("#viewSelected").on("selectmenuchange", selectView);
		refreshDomainList();
		refreshEnvironmentList();
		$("#domainSelected").on("selectmenuchange", selectDomain);
	 });
</script>
</body>
</html>
