<html>
<body>
	<form>
		<fieldset class="form-group">
			<legend>Item fields</legend>
			<div class="form-group row">
				<label class="col-sm-2 col-form-label col-form-label-sm" for="createItemName">Name</label>
				<div class="col-10">
					<input class="form-control form-control-sm" type="text" id="createItemName" onchange="createItemOnNameChange()"/>
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2 col-form-label col-form-label-sm" for="createItemCategory">Category</label>
				<div class="col-10">
					<select class="form-control form-control-sm" type="text" id="createItemCategory" onchange="createItemOnCategoryChange()"/>
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2 col-form-label col-form-label-sm" for="createItemClass">Class</label>
				<div class="col-10">
					<select class="form-control form-control-sm" type="text" id="createItemClass" />
				</div>
			</div>
		</fieldset>
		<hr/>
		<button class="btn btn-primary btn-sm" type="button"
			onclick='createItemValidate();' id="createItemValidateButton">
			<img src='images/92.png' /> create
		</button>
		<button class="btn btn-danger btn-sm" type="button"
			onclick='createItemCancel();' id="createItemCancelButton">
			<img src='images/14.png' /> cancel
		</button>
	</form>
	<script type="text/javascript">
		var classesById = new Array();
		var categoriesById = new Array();
		function createItemOnNameChange(){
			var name = $("#createItemName").val().trim();
			var valid = true;
			if (name.length == 0){
				valid = false;
			}
			if (valid){
				$("#createItemValidateButton").attr("disabled",false);
			} else {
				$("#createItemValidateButton").attr("disabled",true);
			}
		}
		function createItemValidate(){
			var name 		= $("#createItemName").val();
			var className 	= $("#createItemClass").val();
			var data = {
				"name"		 : name,
				"class_name" : className
			}
			$.ajax({
				type 	: "POST",
				url 	: "api/element.php",
				data	: data,
				dataType: "text",
				success	: function( data ) {
					sendMessage("success","Item successfully created");
				}
			}).fail(function(jxqr,textStatus,error){
				sendMessage("error","Unable to create element : "+error);
			});
		}
		function createItemCancel(){
			$("#createItem").panel().close();
		}
		function createItemOnCategoryChange(){
			var categoryId = $("#createItemCategory").val();
			var category = categoriesById[categoryId];
			var htmlClasses = "";
			for (var cl = 0; cl < category.classes.length; cl++){
				clazz = category.classes[cl];
				htmlClasses += "<option value='"+clazz.id+"'>"+clazz.name+"</option>";
			}
			$("#createItemClass").html(htmlClasses);
		}
		$(function() {
			var html = "";
			var category;
			var clazz;
			var htmlClasses = "";
			var first = true;
			for (var c = 0; c < itemCategories.length; c++){
				category = itemCategories[c];
				categoriesById[category.id] = category;
				html += "<option value='"+category.id+"'>"+category.name+"</option>";
				for (var cl = 0; cl < category.classes.length; cl++){
					clazz = category.classes[cl];
					classesById[clazz.id] = clazz;
					if (first){
						htmlClasses += "<option value='"+clazz.id+"'>"+clazz.name+"</option>";
					}
				}
				first = false;
			}
			$("#createItemCategory").html(html);
			$("#createItemClass").html(htmlClasses);
		});
	</script>
</body>
</html>